---
layout: post
title: 'OS X: Moving Files to Trash from your own application, with optional user
  interaction!'
date: '2014-07-07T22:48:00.001+01:00'
author: Thomas Tempelmann
tags:
- Xojo
- Finder
- OS X
modified_time: '2014-07-07T22:50:21.245+01:00'
thumbnail: http://1.bp.blogspot.com/-Fiio3O7iuJE/U7sBWtRNpmI/AAAAAAAAB3k/l3AktMo6f4E/s72-c/locked+file+dlg.png
blogger_id: tag:blogger.com,1999:blog-8797526579651167122.post-7638172477976221886
blogger_orig_url: https://blog.tempel.org/2014/07/osx-move-to-trash.html
---

When you're writing a interactive Mac OS X program, it's possible that you need to delete files.<br /><br />And if they're files the user has access to, then it's often a good idea to move them to the trash instead of erasing them right away, in order to give the user the opportunity to restore them again (saving you the need to provide some kind of Undo command for the destructive operation).<br /><br />Moving items to the Trash is rather complex, and so it's best to just let the Finder perform that task.<br /><br />The Finder is, fortunately, still scriptable, and so this task should be easy. (I must say, though, that I don't know if you can get such an app into the App Store - if you know, please comment.)<br /><br />The challenge is to have the Finder tell the user if there's a problem, such as when the item is locked or when an admin login is needed.<br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Fiio3O7iuJE/U7sBWtRNpmI/AAAAAAAAB3k/l3AktMo6f4E/s1600/locked+file+dlg.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-Fiio3O7iuJE/U7sBWtRNpmI/AAAAAAAAB3k/l3AktMo6f4E/s1600/locked+file+dlg.png" height="111" width="400" /></a></div><div><br /></div><div>Now, if you're trying to be lazy, you'd just write an AppleScript and invoke that from your application (this is especially easy to do in Real Studio / Xojo, but not much harder in ObjectiveC, either).</div><div><br /></div><div>The downside of using an AppleScript is that it won't show these dialogs - if the item can't be moved to the trash, the function will return and give you an error message telling you about the problem.</div><div><br /></div><div>To solve this, you need to invoke the AppleEvent directly, without going through an AppleScript.</div><div><br /></div><div>The Xojo code would look like this, simplified:</div><div><br /><pre>  dim ae as AppleEvent = NewAppleEvent ("core", "delo", "MACS")<br />  dim list as new AppleEventDescList<br />  list.AppendFolderItem (theItemToDelete)<br />  ae.DescListParam("----") = list<br />  ok = ae.send<br /></pre><br /></div><div>However, this won't give us the user interaction either, yet. That's because Xojo's Send command is lacking the options that the OS X API offers.<br /><br />We have to call the native AESend() function via a declare, instead:<br /><br /><div style="-webkit-text-stroke-width: 0px; color: black; font-family: Times; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px;"><pre style="margin: 0px;">  const kAEWaitReply = &amp;h00000003 ' sender wants a reply and will wait<br />  const kAEAlwaysInteract = &amp;h00000030 ' interact where appropriate<br />  const kAECanSwitchLayer = &amp;h00000040 ' interaction may switch layer<br /></pre><pre style="margin: 0px;">  declare function AESend lib "Carbon" (ae as Integer, reply as Ptr,&nbsp;</pre><pre style="margin: 0px;">    sendMode as Integer, prio as Integer, timeoutTicks as Integer,</pre><pre style="margin: 0px;">    idle as Ptr, filter as Ptr) as Integer<br /></pre><pre style="margin: 0px;"> &nbsp;dim sendMode as Integer</pre><pre style="margin: 0px;">  sendMode = kAEWaitReply + kAEAlwaysInteract + kAECanSwitchLayer</pre><pre style="margin: 0px;">  dim err as Integer = AESend (ae.Ptr, nil, sendMode, 0, 0, nil, nil)<br />        <br /></pre><div style="margin: 0px;">The same can be applied to copying files with user interaction as well - use the "clon" instead of the "delo" value for the AppleEvent.</div><div style="margin: 0px;"><br /></div><div style="margin: 0px;">I've made a REALbasic / Xojo project with both a MoveItemsToTrash() and CopyItems() function for your own use. <a href="http://files.tempel.org/RB/Xojo%20Finder%20Copy%20and%20Move%20To%20Trash.zip">Download here</a>.</div><div style="margin: 0px;"><br /></div></div></div>