---
layout: post
title: 'Xojo''s Build Automation: Beware of CopyFiles'
date: '2013-08-06T09:44:00.002+01:00'
author: Thomas Tempelmann
tags:
- Xojo
- Xojo Bugs
modified_time: '2013-08-06T11:21:40.856+01:00'
blogger_id: tag:blogger.com,1999:blog-8797526579651167122.post-4788944977348113867
blogger_orig_url: https://blog.tempel.org/2013/08/xojos-build-automation-beware-of.html
---

If you use the Xojo IDE's CopyFiles build step to add files to your built application, beware of this long-existing bug.<br /><br />Maybe you've had this happen yourself: You're pretty sure you had added some entries to a CopyFiles step, but they're not there any more. And you can't remember that you've removed them, either.<br /><br />Here's what happens:<br /><br />If you open a Xojo project, the IDE checks if the files referenced in the CopyFiles step do actually exist. And if they don't exist, the IDE deletes these entries - without a warning. Then, if you save your project, the entries are gone forever, even if you make the missing files available&nbsp;again.<br /><br />And it's not just missing files (something that could happen if you copied your project to another computer, e.g. using a version control system, and forgot to also copy these files along)!<br /><br />The same happens if you just move your project file without also moving the referenced files relatively to it, or if you&nbsp;move or rename the referenced file temporarily.&nbsp;This is surprising because doing this is not an issue with regular external items added to the IDE!<br /><br />I plan to soon add a check to <a href="http://www.tempel.org/Arbed" target="_blank">Arbed</a> so that it will warn me when it notices that a file that's referenced in a CopyFiles step is not available. Since I do <a href="http://www.tempel.org/Arbed/SCM" target="_blank">use Arbed with git</a>, it's likely to notice this issue as soon as I verify the changes on a computer that's missing the CopyFiles step files.<br /><br />I've filed the issue as&nbsp;<a href="feedback://showreport?report_id=28676">Feedback #28676</a>. Though, this only describes the issue that the IDE drops the entries if the files are not found. The other issue is that the IDE doesn't find the files if the project has been moved to another folder:&nbsp;<a href="feedback://showreport?report_id=28678">Feedback #28678</a>.<br /><br />Until these issues are fixed, I recomment using a IDE Script instead, issuing a shell command to copy the files. That way, you can check if the shell command fails and report the issue, e.g. like this (Mac and Linux only, for Windows you'll need different code):<br /><br /><pre>  dim cmds(), s, dst as String<br /><br />  // The path to the built app's Resources folder (Mac):<br />  dst = CurrentBuildLocation+"/"""+CurrentBuildAppName+""".app"<br />  dst = dst+"/Contents/Resources/"<br /><br />  // prepare the commands<br />  cmds.Append "cd  ""$PROJECT_PATH""" // Move to the project folder<br />  cmds.Append "cp myfile "+dst // Copy "myfile" to app's Resources folder<br /><br />  s = DoShellCommand (Join (cmds, ";"))<br />  if s &lt;&gt; "" then<br />    print "Copy failed: "+s<br />  end</pre><br /><hr align="center" width="80%" /><br />BTW, this issue wouldn't be one if the IDE would handle these CopyFiles&nbsp;references the same way as it does for general external files and classes added to a project. Because, if such files are temporarily missing, the project doesn't simply drop them. If you look into the project file, e.g. by saving it in XML format, you'll see that external files added to the project are referenced in three ways: With an absolute path, with a path relative to the project files, and with a "SaveInfo", which uses the special Finder Alias format, allowing it to locate files even if they've been renamed or moved, as long as they're still on the same volume.&nbsp;On the other hand,&nbsp;CopyFiles uses only use a relative path (which is, unfortunately, titled "FileAlias", misleadingly suggesting it being a powerful Finder Alias).<br /><br />In my opinion, the implementation of CopyFiles was done quite badly (it's not the only bug with this seemingly simple feature), where the programmer clearly did not understand how the IDE usually references external files, instead making up its own solution, which isn't only inferior but even leads to data loss.