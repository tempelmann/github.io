---
layout: post
title: Customizing Xojo's controls on OS X with Cocoa
date: '2014-03-26T22:10:00.000Z'
author: Thomas Tempelmann
tags:
- Xojo
- Cocoa
- OS X
modified_time: '2014-03-26T22:39:02.296Z'
thumbnail: http://2.bp.blogspot.com/-dPTsDxC_EDU/UzNAeMzJf8I/AAAAAAAAB1w/Sc08h2a4XAk/s72-c/controls+lib.PNG
blogger_id: tag:blogger.com,1999:blog-8797526579651167122.post-1564410590741983228
blogger_orig_url: https://blog.tempel.org/2014/03/customizing-xojos-controls-on-os-x-with.html
---

<h3>This article is about some advanced techniques for Xojo users that write OS X Cocoa apps.</h3><br />If you are using Xojo to build OS X Cocoa applications, you can customize the controls much further than Xojo offers directly.<br /><br />Let's take the PopupMenu. It's fairly limited in appearance (one look only) and capabilities (no icons in the menu, for instance).<br /><br />Changing the appearance of such a control is easy because for most of Xojo's controls there is a Cocoa control equivalent, and you can directly alter those Cocoa controls from your code.<br /><br />First, find out what you like to change in a control. You could look up Apple's documentation for the NSPopupButton, for instance. An easier way is to use Xcode as you can then see immediately the results in Xcode's interface designer.<br /><br />Get Xcode from developer.apple.com, launch it, and choose New Project... from the menu.<br />Choose OS X - Application - Cocoa Application. Click Next. Give the project a name and check "Create Document-Based Application". Click Next and save it, e.g. to the Desktop.<br /><br />In the browser menu on the left, select "Document.xib". That will show you the window editor, similar to Xojo's layout editor.<br /><br /><a href="http://2.bp.blogspot.com/-dPTsDxC_EDU/UzNAeMzJf8I/AAAAAAAAB1w/Sc08h2a4XAk/s1600/controls+lib.PNG" imageanchor="1" style="clear: right; display: inline !important; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://2.bp.blogspot.com/-dPTsDxC_EDU/UzNAeMzJf8I/AAAAAAAAB1w/Sc08h2a4XAk/s1600/controls+lib.PNG" height="200" width="195" /></a>At the right of the Xcode window, at the bottom, there is a list of controls to choose from:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-j4hITqsYB90/UzNAeN7DoLI/AAAAAAAAB14/QSE5SpbRJOk/s1600/layout.PNG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://4.bp.blogspot.com/-j4hITqsYB90/UzNAeN7DoLI/AAAAAAAAB14/QSE5SpbRJOk/s1600/layout.PNG" height="116" width="200" /></a></div>Find the "Pop Up Button" and drag it into the layout window. The window should then look like this:<br /><div><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-AeBOi7E6ILk/UzNAeEJfhsI/AAAAAAAAB10/SdPhfXvm9tQ/s1600/properties.PNG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://3.bp.blogspot.com/-AeBOi7E6ILk/UzNAeEJfhsI/AAAAAAAAB10/SdPhfXvm9tQ/s1600/properties.PNG" height="199" width="200" /></a></div><div style="text-align: left;"><span style="text-align: center;">Click on the added button to select it, and on right side of the Xcode window, click on the properties button (the one shown in blue here).</span></div><div style="text-align: left;"><span style="text-align: center;"><br /></span></div><div style="text-align: left;">You will see the various&nbsp;properties you can alter.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-gBQsdhoNxDY/UzND1pwlQqI/AAAAAAAAB2M/5Sfqm56FE4k/s1600/inlinestyle.PNG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://4.bp.blogspot.com/-gBQsdhoNxDY/UzND1pwlQqI/AAAAAAAAB2M/5Sfqm56FE4k/s1600/inlinestyle.PNG" /></a></div><div style="text-align: left;">For example, let's change the Style to Inline. Do that and see how the appearance of the popup menu changes:</div><br /><div style="text-align: left;"><br /></div><h3>Now let me show you how to do that in your Xode program.</h3><div style="text-align: left;"><br /></div><div style="text-align: left;">I assume you know how to add a PopupMenu control to a window in Xojo.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Add an Open event to the PopupMenu in the window, and add the following code:</div><div style="text-align: left;"><span style="font-family: Courier New, Courier, monospace;"><br /></span></div><div style="text-align: left;"><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace;">Declare Sub setBezelStyle Lib "Cocoa" _</span></div><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; Selector "setBezelStyle:" (obj as Integer, v as Integer)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; const NSInlineBezelStyle = 15</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; setBezelStyle (me.Handle, NSInlineBezelStyle)</span><br /><br />If you run your Xojo project, the popup button should now have the changed appearance.<br /><br />However, it might be that the up+down arrows are centered, not on the right as they should. If you look at the Xcode project and play around with the settings for the Popup control, you'll see that the Arrow property controls this - if it's set to "Center", it's placing the arrows in the center. Let's see if we can fix the Popup menu in Xojo to have its Arrows set to "Bottom" instead. Add these lines:<br /><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; Declare Sub setArrowPosition Lib "Cocoa" Selector "setArrowPosition:" (obj as Integer, v as Integer)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; Declare Function cell Lib "Cocoa" Selector "cell" (obj as Integer) as Integer</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; const NSPopUpArrowAtBottom = 2</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; setArrowPosition (cell (me.Handle), NSPopUpArrowAtBottom)</span><br /><br />Now I'll explain what's going on:<br /><br /><span style="font-family: 'Courier New', Courier, monospace;">setBezelStyle</span><span style="font-family: inherit;">&nbsp;is a function of <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/applicationkit/classes/NSButton_Class/Reference/Reference.html" target="_blank">NSButton</a>, which is the super class of&nbsp;</span><a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/applicationkit/classes/NSPopUpButton_Class/Reference/Reference.html" target="_blank">NSPopUpButton</a>. Unfortunately, Xcode does not tell us that its "Style" property is actually called "bezelStyle", so I had to search the documentation for it anyway. me.Handle is the Xojo control's reference to the Cocoa object (i.e. the NSPopUpButton object), and we've then declared a Xojo function with the name&nbsp;<span style="font-family: 'Courier New', Courier, monospace;">setBezelStyle</span>&nbsp;that invokes the "setBezelStyle:" selector, passing it an Integer value. Note that for every Cocoa property you find, there is always a setter function named after this pattern, e.g. "name" -&gt; "setName:".<br /><br />Getting access to the Arrow&nbsp;property was a little more complicated. Neither NSPopUpButton nor any of its super classes provides a function to set this&nbsp;property. Instead, it's found in the <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/applicationkit/classes/NSPopUpButtonCell_Class/Reference/Reference.html" target="_blank">NSPopUpButtonCell</a> class. To get to values of this class, we need to use the cell function (found in the <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/applicationkit/classes/NSControl_Class/Reference/Reference.html" target="_blank">NSControl</a> class).<br /><br />If you do not like to figure all this out yourself, you can also take a look at <a href="https://github.com/macoslib/macoslib" target="_blank">MacOSLib</a> or use the <a href="http://www.monkeybreadsoftware.net/class-nspopupbuttonmbs.shtml" target="_blank">MBS plugins</a>. Especially with MBS it's very easy to acess these Cocoa control&nbsp;properties &nbsp;or add icons to a PopupMenu's items.<br /><br /><h3>But wait, there's more!</h3><br />This is getting pretty advanced now.<br /><br />Cocoa is built on Objective C, which, contrary to C++ and Xojo, lets you get right down to the lowest level where you can call functions (called messages in ObjC) by name. From a String.<br /><br />Which means that you can store the function name you want to call in a String, or even read it from a file, and then invoke it.<br /><br />Here's an example to show you what I mean. The above code for setting the style could also be written like this:<br /><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; Declare Function NSSelectorFromString Lib "Cocoa" _</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; (aSelectorName as CFStringRef) As Ptr</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; Declare Sub objc_msgSend_int Lib "Cocoa" Alias "objc_msgSend" _</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; (obj as Integer, sel as Ptr, v as Integer)</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; dim f as String =&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace;">"setBezelStyle:"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; objc_msgSend_int (me.Handle, NSSelectorFromString(f), NSInlineBezelStyle)</span><br /><br />See how "setBezelStyle:" is stored in a string variable here?<br /><br />This Cocoa control also has an "alignment", so let's try altering that as well. The function name to change the value is thus "setAlignment:" (the ":" at the end is important and specifies that the function gets one value passed to it). So add this code:<br /><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; dim f as String =&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace;">"setAlignment:"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; objc_msgSend_int (me.Handle, NSSelectorFromString(f), 1)</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: inherit;">And with that, we've right-aligned the text in the popup menu.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">With this procedure, you could now define customizations for your Xojo/Cocoa controls by specifying the properties and values in a file, and generically assign those properties in your code, without the need to write a special case for every property you might want to change.</span><br /><span style="font-family: inherit;"><br /></span><h3><span style="font-family: inherit;">Demo project!</span></h3><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;"><a href="http://files.tempel.org/RB/Customized%20PopupControl%20in%20Cocoa.rbp.zip">Click here to download a demo project using above techniques.</a></span><br /><span style="font-family: inherit;"><br /></span>